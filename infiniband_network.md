## 进度计划：

内部功能2022年5月完成集成；协作单位功能2022年10月完成集成。

因此，交换网络硬件及软件支撑条件，预计在2021年12月之前完成，以支撑各项功能集成。

## 交换网络硬件及软件工作项：

### 硬件工作项

*  全系统集成硬件：

1交换芯片 + 20接口芯片组成的交换机箱，对外出40路16XPCIE光纤接口，具体结构形式需要讨论确定，需求两套（预计系统由两个机架组成）。

*  各家测试支撑硬件

各家各自功能调试的硬件支撑，这个可能比较棘手，目前考虑，1交换芯片+4接口芯片的裁剪版交换机箱，需求5套。

### 软件工作项

支持FPGA与CPU芯片的互联，通信模式为FPGA-FPGA,FPGA-CPU,CPU-CPU, 提供节点间的消息收发功能和消息多播功能；FPGA基于PCIE接口封装消息收发接口，CPU提供消息通信库。具体提供的接口方式需要讨论确定。

CPU需要增加对飞腾、龙芯、申威国产CPU的支持，目前正在努力，看能否统一使用ARM核心的飞腾CPU，降低工作量。




### 附录

#### 前期技术交流情况

##### NI、SW接口芯片工作机制理解

###### 支持2K内的消息和RDMA操作。

###### 发送消息或RDMA操作时，几个步骤：

1 在FPGA的空间里，构造源操作描述符队列，以及与源操作描述符队列对应的操作完成队列。(源操作队列我理解可以是读也可以是写？)

2 FPGA写IO空间按门铃触发某个源操作队列的收发操作，操作过程中，NI会通过PCIE读操作读取FPGA空间里的数据。

3 操作结束后，NI通过PCIE写操作，修改完成队列的对应表项，以通知完成，对于CPU，会产生中断，对于FPGA，可不依赖中断。

4 可指定垃圾完成队列忽略操作结果。

###### 可以操作NI内置的描述符，构造64字节的短RDMA直接写数据到目标节点内存。（但没有读操作？）

###### 多播功能，只能是2K内的消息，不支持RDMA块数据，SW上同行的拷贝可同时进行，不同行的只能逐一拷贝。

###### 操作描述符，如果是2K内消息，2K消息与描述符紧凑排列，如果是RDMA块数据，描述符通过指针指向数据？？？


##### 为进行FPGA与CPU之间通信验证，需要的支持

###### 操作描述符与完成队列表项的等结构定义。

###### CPU端的驱动库及API
